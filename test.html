<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8"> 
  <title>ConvoyParser v1.06</title>
  <script language="javascript">

  // Raw multiline text field content.
    var gsInputText  = "";
    var gsOutputText = "";

    // Input language.
    var gbFrenchInput = true;
    var gbEnglishInput = true;

    // Kind of reports (Convoys : Arrived, Sent, Received).
    var gbArrived  = true;
    var gbSent     = true;
    var gbReceived = true;

    // Output formatting.
    var gTabOutput = new Array("TEXTE / TEXT", "EXCEL (Tabulé avec séparateur de milliers / Tabbed with thousand separator)", "GOOGLE Spreadsheet (Tabulé sans séparateur de milliers / Tabbed without thousand separator)");
    var giCurOutput        = 0;
    var giOutputSearchDate = 1;
    var gTabLang = new Array("Rapport en Français / French output", "Rapport en Anglais / English output");
    var giOutputLang = 0;
    
    var gbOutputTotal = true;
    var gbOutputConveyorTotal = true;
    var gbOutputReceiverTotal = true;
    var gbOutputFullList = true;
    var gbTabToDisplay = new Array(true, true, true, true, true, false, false, false);
    
    var gsOutputHeader = new Array();
    gsOutputHeader[0] = new Array("Convoyeur", "Livré", "Nourriture", "Matériaux", "Date", "Déclaré par", "Type de déclaration", "Langue serveur", "Nb convoi Nourriture", "Nb convoi matériaux");
    gsOutputHeader[1] = new Array("Conveyor", "Delivery target", "Food", "Materials", "Date", "Declared by", "Declaration type", "Server Language", "Food convoy count", "Material convoy count");
    var gsOutputSeparator = new Array();
    gsOutputSeparator[0] = new Array("", " > ", "", " : ", "", " Nourriture et ", "", " Matériaux.", " Le : ", "", ", Déclaré par : ", ""," (Type de déclaration : ", ")");
    gsOutputSeparator[1] = new Array("", " > ", "", " : ", "", " Food and ", "", " Materials.", " On : ", "", ", Declared by : ", ""," (Declaration type : ", ")");

    var gsTabOutputType = new Array();
    gsTabOutputType[0] = new Array(); gsTabOutputType[0]["Arrived"] = "Arrivé"; gsTabOutputType[0]["Sent"] = "Envoyé"; gsTabOutputType[0]["Received"] = "Reçu";
    gsTabOutputType[1] = new Array(); gsTabOutputType[1]["Arrived"] = "Arrived"; gsTabOutputType[1]["Sent"] = "Sent"; gsTabOutputType[1]["Received"] = "Received";
    
    var gPos;
    
    // Players list for Authors
    var gsNoAlliance       = " - ";
    var gTabPlayer         = new Array();
    var gTabAllianceChoice = new Array(gsNoAlliance, "S2 : Table ronde, Nov. 2016", "S3 : 47, Nov. 2016", "S3 : LCM, Nov. 2016", "S4 : RnC, May 2020", "S4 : LCA, Aug 2023");
    var gTabAlliancePlayer = new Array();
    gTabAlliancePlayer["S2 : Table ronde, Nov. 2016"] = new Array("Antfufu", "ArchSeraph", "bdsr56", "beus93", "brandnew", "breizman", "Bryansixx", "buzwell", "Calystene", "carpette43", "Coryphee", "coucou", "crocnoir", "cstinger", "elmine28", "Enema", "fanfan45", "FiZeR", "fourmiscotto", "fourmi-sonia", "Gandoulf", "hannibal80", "k005482", "koniks", "krondgens", "kyla3", "laredoutablefourmierouge", "lotaxo", "mathieuaime", "mikiki", "Moloch", "Neos", "pecheur", "Prince-Actarus", "Rodhead", "saperlipopette", "smooth-V-2", "snoppy", "thegodfather", "thonath", "titi72", "toby", "Trunks", "tyty", "uskar", "yumi");
    gTabAlliancePlayer["S3 : 47, Nov. 2016"] = new Array("Adrien", "Allerdyce", "aschatan", "blade", "brabancon", "castor", "cevi18", "choupette", "cyberkiki", "damsrasta", "daubinum", "deep", "destichado", "Destroyeur62", "dobby", "Dragon25", "Drax", "Elea", "elfe", "ggaabbii", "graxy", "GuillaumeF", "kandide", "kimi", "krondgens", "lafourmirousse22", "loki", "macewindu", "Mayaserana", "Minibug", "MistAr", "Naomy", "Nissart", "Nordal", "nounouch", "Nwoaar", "olitest", "Ostrogott", "Phenix", "Pololamagouille", "Prend-Ta-Claque", "quilanvos78", "shub", "Shyzenka", "Sizz31", "SpartanGoldberg", "Stalky", "stankou", "Struf", "tobeerox", "trouch", "Truncgo", "Undertaker23");
    gTabAlliancePlayer["S3 : LCM, Nov. 2016"] = new Array("2FLAG", "AliceInWonderland", "alinus410", "bebert39", "Bip-", "black-sw1n", "Bobbydu80", "Cavernog", "daerim", "Darkclubber", "Elysha", "fleea", "florian45", "fourmitorus", "fredy3", "Fulanke", "Gaia_atlas", "Golgotha", "jfk67", "joris39", "josephine", "kaina", "Kroonde", "Lucy_Scarfield", "machet", "maitre007", "mauegyptien", "mcgreg", "miryou", "MoonEclipse", "Obelix", "ouisti", "poumba8", "raphael52", "Raxzephon", "sanguis", "Schlipouny", "smiorgan", "Soban", "sonic974", "supermage87", "taoklm", "tresor-24", "TRojan13");
    gTabAlliancePlayer["S4 : RnC, May 2020"] = new Array("Adonis21", "Arabesque", "arnaudsheyna", "Avol", "BarneyStinson", "binet", "Bragi", "bribridu77", "Cafard-Hurlant", "Caiissa", "Calystene.", "cars", "Cizayox", "Delicechoc", "ducdemont", "etmg", "Evallyne1", "Fatalice", "filou81", "Gonbay", "headhunterz", "hegibx", "insectus", "joeyzaza", "jordaninkof", "jrmy44", "Kainan", "kalinette", "Kaprika", "klump", "Leonnix500", "leyannoux", "lili", "Magby34", "Messala", "Pantagruel", "papaman", "Pink-Floyd", "reivax54", "rol30", "sachris", "SargonnaS", "scar", "Shub", "Sonic78", "Swag", "tatadalilo", "Tereduk", "Trohn", "Ugluk", "vallian", "wistiti", "WOoOM", "xouxou71");
    gTabAlliancePlayer["S4 : LCA, Aug 2023"] = new Array("Caiissa", "Pantagruel", "kalinette", "sestre", "sandredu43", "Drakena", "leyannoux", "hegibx", "Samanosker31", "insectus", "vallian", "headhunterz", "Calystene.", "Riritus", "papaman", "Boba.FETT", "Delicechoc", "Gilcat", "billom1");
    
    var giWarningLevel = 1;
    var gsWarningLevel = new Array("Haut / High", "Moyen / Average", "Bas / Low");
    
    // Extracted data storage.
    var gTabConvoys = new Array();
         
    // ************************************
    // Current document dedicated function.
    // ************************************
    
    function Analyse()
    {
      // Réinotialise error and debug outputs
      document.getElementById("idError").value = "";
      document.getElementById("idDebug").value = "";
      
      // Get possible author list
      gTabPlayer = (document.getElementById("idPlayerList").value).split("\n")
      
      gTabConvoys = ParseConvoy(gsInputText, gTabPlayer, gbArrived, gbSent, gbReceived, gbFrenchInput, gbEnglishInput, giWarningLevel);
     
      GenerateOutput();
    }
    
    // Convoy parser function : extract convoy data from raw text.
    // Parameters :
    // - p_sInputText = raw text to parse for convoys data.
    // - p_sTabAuthor : array of aliases to detect author of posted messages.
    // - p_bParseArrived, p_bParseSent, p_bParseReceived : requirement to detect this type of convoy declaration. (All can be true).
    // - p_bParseFrenchInput, p_bParseEnglishInput : requirement to detect French/English convoy declaration. (Both can be true).
    // Return : Array of convoy, each convoy is an array with the following indexes : "food", "material", "author", "conveyor", "target", "date", "lang", "type".  
    //          (for instance : Tab = ParseConvoy([...]); iFirstConvoyFoodAmount = Tab[0]["food"]; sSecondConvoyReceiver = Tab[1]["target"];)
    // - p_bWarningLevel : Warning level (0 = High/vernose, 1 = Middle, 2 = Low), to try to detect truncated declarations. The higher, the higher the risk of false detection.
    // Functions dependencies :
    // - Require :   function parseDate(p_sRawData)  // parse a raw string and return an array with four indexes/values : "HourFound"/boolean, "HourTxt"/string,  "DateFound"/boolean, "DateTxt"/string.
    // - Call to :   function ScrollToAndDisplayErrors()  // Scroll to error window and show it (in this use case, but this function implementation may be adapted to reuse needs).
    // - Call to :   function AddErrorLine(asText, asType)   // Error log function. asText = message to display, asType = "error" / "warning" / "raw" (for formatting needs).  (in this use case, but this function implementation may be adapted to reuse needs).
    function ParseConvoy(p_sInputText, p_sTabAuthor, p_bParseArrived, p_bParseSent, p_bParseReceived, p_bParseFrenchInput, p_bParseEnglishInput, p_bWarningLevel)
    {
      var tabLine = p_sInputText.split("\n");
      
      var sPlayer = "";
      var sAuthor = "";
      var iLineAuthor = 0;
      
      var tabDateCurLine = new Array();
      var tabDatePrevLine = new Array();
      
      var sTemp1, sTemp2, iFood, iMaterial;
      
      sTabConvoys = new Array();
      var iConvoy;
      
      // Check what type has to be analysed (may be several).
      var typeList = new Array();
      if (p_bParseArrived)  typeList.push(0);
      if (p_bParseSent)     typeList.push(1);
      if (p_bParseReceived) typeList.push(2);
      var iCurType;
      
      // Check which input language has to be analysed (may be both).
      var langList = new Array();
      if (p_bParseFrenchInput)  langList.push(0);
      if (p_bParseEnglishInput) langList.push(1);
      var iCurLang;
      
      // Delimiters.
      var sTabDel = new Array;
      sTabDel[0]  = new Array;
      sTabDel[1]  = new Array;
      var sTabReg = new Array;
      sTabReg[0]  = new Array;
      sTabReg[1]  = new Array;
      // French arrived convoy
      sTabDel[0][0] = new Array("Votre livraison de", "nourriture et", "matériaux est arrivée chez", " est arrivée chez", ". Vos ouvrières");
      sTabReg[0][0] = new Array(
        "(Votre livraison de[ 0-9]*nourriture et)|(Votre livraison de [ 0-9]* et )", 
        "(nourriture et[ 0-9]*matériaux est arrivée chez)|( et [ 0-9]* est arrivée chez)");
      // French sent convoy
      sTabDel[0][1] = new Array("Vous allez livrer", "nourritures et", "materiaux à", " à ", "dans");
      sTabReg[0][1] = new Array(
        "(Vous allez livrer[ 0-9]*nourritures et)|(Vous allez livrer[ 0-9]* et )", 
        "(nourritures et[ 0-9]*materiaux à)|( et [ 0-9]* à )");
      // French received convoy
      sTabDel[0][2] = new Array("vient de vous livrer", "nourriture et", "matériaux.", " ", "vient de vous livrer");
      sTabReg[0][2] = new Array(
        "(vient de vous livrer[ 0-9]*nourriture et)|(vient de vous livrer[ 0-9]* et )", 
        "(nourriture et[ 0-9]*matériaux.)|( et [ 0-9]*.)");
      // English arrived convoy
      sTabDel[1][0] = new Array("Your delivery of", "food and", "material arrived at", " arrived at", ". Your workers are back.");
      sTabReg[1][0] = new Array(
        "(Your delivery of[ 0-9]*food and)|(Your delivery of[ 0-9]* and )", 
        "(food and[ 0-9]*material arrived at)|( and [ 0-9]*arrived at)");
      // English sent convoy
      sTabDel[1][1] = new Array("You are going to deliver", "food and", "Materials to", " to ", "in");
      sTabReg[1][1] = new Array(
        "(You are going to deliver[ 0-9]*food and)|(You are going to deliver[ 0-9]* and )", 
        "(food and[ 0-9]*Materials to)|( and [ 0-9]* to )");
      // English received convoy
      sTabDel[1][2] = new Array("just delivered", "food and", "material to you.", " ", "just delivered");
      sTabReg[1][2] = new Array(
        "(just delivered[ 0-9]*food and)|(just delivered[ 0-9]* and )", 
        "(food and[ 0-9]*material to you.)|( and [ 0-9]* to you.)");
      
      // Discard line regexp mask when searching for author.
      var sRegExcludeAuthor = "Votre livraison|Vous allez livrer|vient de vous livrer|Your delivery of|You are going to deliver|just delivered|Convoi livré à|Convoy sent to|Convoi venant de chez|Convoy received from";
      
      // Try to detect bad formatted convoys for warning.
      var sTabRegFindBadConvoys = new Array();
      sTabRegFindBadConvoys[0] = "delivered|to you|to deliver|food and (.*) Materials|arrived at|delivery|Your workers|materiaux à| dans |Retour le|livrer|vient de vous|livraison de|est arrivée|Vos ouvrières";
      sTabRegFindBadConvoys[1] = "just delivered | material to you|to deliver | food and ([ 0-9]*) Materials | arrived at |delivery of |Your workers are back| materiaux à (.*) dans | - Retour le|allez livrer ([ 0-9]*) nourritures et | vient de vous livrer |livraison de ([ 0-9]*) nourriture| matériaux est arrivée chez |Vos ouvrières sont de retour";
      sTabRegFindBadConvoys[2] = " just delivered ([ 0-9]*) food and ([ 0-9]*) material to you.|You are going to deliver ([ 0-9]*) food and ([ 0-9]*) Materials to (.*) in|Your delivery of ([ 0-9]*) food and ([ 0-9]*) material arrived at (.*). Your workers are back.| Vous allez livrer ([ 0-9]*) nourritures et ([ 0-9]*) materiaux à (.*) dans | vient de vous livrer ([ 0-9]*) nourriture et ([ 0-9]*) matériaux.|Votre livraison de ([ 0-9]*) nourriture et ([ 0-9]*) matériaux est arrivée chez (.*). Vos ouvrières sont de retour.";
      
      // Label for convoy type
      var sTabTypeList = new Array("Arrived", "Sent", "Received");
      
      // Current line
      var iLine, iType, iLang, iPlayerIndex;
      
      // Parser error detected.
      var nbError = 0;
      var bError = false;
      var sError = new Array();
      var iErrorLine = 0;
      
      var nbAlert = 0;
      var bAlert = false;
      var sAlert= new Array();
      
      var bIsNotConvoy = true;
      
      // Build a regexp string to detect and raise a warning on Unread messages.
      var sPlayerUnreadDetector = "";
      for (iPlayerIndex = 0; iPlayerIndex < p_sTabAuthor.length; iPlayerIndex++)
      {
        sPlayerUnreadDetector += (iPlayerIndex == 0 ? "" : "|") + "(" + TrimSpaces(p_sTabAuthor[iPlayerIndex]) + "Non lu)|(" + TrimSpaces(p_sTabAuthor[iPlayerIndex]) + "Unread)";
      }
      
      // Parse each input line.
      for (iLine = 0; iLine < tabLine.length; iLine++)
      {
        tabLine[iLine] = TrimSpaces(tabLine[iLine]);
        bError = false;
        bAlert = false;
        bIsNotConvoy = true;
        // Analyse for each type (arrived, sent, received), if required.
        for (iType = 0; iType < typeList.length; iType++)
        {
          iCurType = typeList[iType];
          // Analyse for each input language (French, English), if required.
          for (iLang = 0; iLang < langList.length; iLang++)
          {
            iCurLang = langList[iLang];
            // Check if current line contains desired type and extract data if so.
            if (tabLine[iLine].indexOf(sTabDel[iCurLang][iCurType][0]) >= 0)
            {
              bIsNotConvoy = false;
              
              // Try to get "target" (target for arrived or sent, conveyor for received).
              sPlayer = "?";
              sTemp1 = " " + tabLine[iLine];
              if (new RegExp(sTabDel[iCurLang][iCurType][3] + ".*" + sTabDel[iCurLang][iCurType][4], "g").test(sTemp1))
              {
                sTemp2 = " " + (new RegExp(sTabDel[iCurLang][iCurType][3] + ".*" + sTabDel[iCurLang][iCurType][4], "g").exec(sTemp1))[0];
                sTemp1 = TrimSpaces(sTemp2.substring(sTemp2.indexOf(sTabDel[iCurLang][iCurType][3], 0) + (sTabDel[iCurLang][iCurType][3]).length, sTemp2.indexOf(sTabDel[iCurLang][iCurType][4], 0)));
                if (sTemp1.lastIndexOf(" ") >= 0)
                {
                  sPlayer = TrimSpaces(sTemp1.substring(sTemp1.lastIndexOf(" ") + 1));
                } else
                {
                  sPlayer = sTemp1;
                }
              } else
              {
                bError = true;
                sError[sError.length] = "ERROR : TARGET / RECEIVER, no match to : \"" + sTabDel[iCurLang][iCurType][3] + "\"...\"" + sTabDel[iCurLang][iCurType][4] + "\"";
              }
              
              // Try to get food amount.
              //sTemp1 = TrimSpaces(tabLine[iLine].substring(tabLine[iLine].indexOf(sTabDel[iCurLang][iCurType][0], 0) + (sTabDel[iCurLang][iCurType][0]).length, tabLine[iLine].indexOf(sTabDel[iCurLang][iCurType][1], 0)));
              iFood = 0;
              if (new RegExp(sTabReg[iCurLang][iCurType][0], "g").test(tabLine[iLine]))
              {
                sTemp1 = (new RegExp(sTabReg[iCurLang][iCurType][0], "g").exec(tabLine[iLine]))[0];
                sTemp2 = (new RegExp("[^ 0-9]([0-9 ]{3,20})[^ 0-9]", "g").exec(sTemp1))[0];
                sTemp1 = sTemp2.substr(1, sTemp2.length - 2);
                iFood = parseInt(RemoveAllSpaces(sTemp1));
              } else
              {
                bError = true;
                sError[sError.length] = "ERROR : FOOD AMOUNT, no match to : \"" + sTabReg[iCurLang][iCurType][0] + "\"";
              }
              
              // Try to get material amount.
              //sTemp1 = TrimSpaces(tabLine[iLine].substring(tabLine[iLine].indexOf(sTabDel[iCurLang][iCurType][1], 0) + (sTabDel[iCurLang][iCurType][1]).length, tabLine[iLine].indexOf(sTabDel[iCurLang][iCurType][2], 0)));
              iMaterial = 0;
              if (new RegExp(sTabReg[iCurLang][iCurType][1], "g").test(tabLine[iLine]))
              {
                sTemp1 = (new RegExp(sTabReg[iCurLang][iCurType][1], "g").exec(tabLine[iLine]))[0];
                sTemp2 = (new RegExp("[^ 0-9]([0-9 ]{3,20})[^ 0-9]", "g").exec(sTemp1))[0];
                sTemp1 = sTemp2.substr(1, sTemp2.length - 2);
                iMaterial = parseInt(RemoveAllSpaces(sTemp1));
              } else
              {
                bError = true;
                sError[sError.length] = "ERROR : MATERIAL AMOUNT, no match to : \"" + sTabReg[iCurLang][iCurType][1] + "\"";
              }
              
              // Try to get player posting message (Author).
              sAuthor = "?";
              iLineAuthor = iLine;
              while (sAuthor.length < 2 && iLineAuthor > 0)
              {
                iLineAuthor--;
                sTemp1 = tabLine[iLineAuthor];
                // don't take into account convoy or RC header lines.
                if (!(new RegExp(sRegExcludeAuthor, "g").test(sTemp1)))
                {
                  for (iPlayerIndex = 0; iPlayerIndex < p_sTabAuthor.length; iPlayerIndex++)
                  {
                    sTemp2 = TrimSpaces(p_sTabAuthor[iPlayerIndex]);
                    
                    //var t003 = new RegExp(sTemp2, "g").test(sTemp1);
                    //var t004 = sTemp2.length > 1;
                    //var t005 = t003 && t004;
                   
                    if (new RegExp("(^|[^0-9a-zA-Z])" + sTemp2 + "($|[^0-9a-zA-Z])", "g").test(sTemp1) && sTemp2.length > 1)
                    {
                      sAuthor = TrimSpaces(p_sTabAuthor[iPlayerIndex]);
                      if (sAuthor == sPlayer && sAuthor.length)
                      {
                        sAuthor = "?";
                      } else
                      {
                        //Debug("Line = " +  tabLine[iLine]);
                        //Debug("Line author = " + sTemp1);
                        //Debug("(new RegExp(sTemp2, \"g\").test(sTemp1) && sTemp2.length > 1) = " + (new RegExp(sTemp2, "g").test(sTemp1) && sTemp2.length > 1));
                        //Debug("Line / Author Line : " +  iLine + " / " + iLineAuthor + ", Player : " + sAuthor + " (" + sTemp1.indexOf(sAuthor) + ")")
                        //break;
                      }
                    } 
                  }
                }
              }
              
              // Try to get Date
              tabDateCurLine = parseDate(tabLine[iLine]);
              tabDatePrevLine = parseDate(tabLine[iLine > 0 ? iLine - 1 : iLine]);
              sDate = TrimSpaces(tabDateCurLine["DateFound"] ? tabDateCurLine["DateTxt"] : (tabDatePrevLine["DateFound"] ? tabDatePrevLine["DateTxt"] : "?")); 
              sDate += " " + TrimSpaces(tabDateCurLine["HourFound"] ? tabDateCurLine["HourTxt"] : (tabDatePrevLine["HourFound"] ? tabDatePrevLine["HourTxt"] : "?")); 
              
              // Record extracted datas...
              iConvoy = sTabConvoys.length; 
              sTabConvoys[iConvoy] = new Array();
              sTabConvoys[iConvoy]["type"] = sTabTypeList[iCurType];
              sTabConvoys[iConvoy]["food"] = iFood;
              sTabConvoys[iConvoy]["material"] = iMaterial;
              sTabConvoys[iConvoy]["author"] = sAuthor;
              sTabConvoys[iConvoy]["conveyor"] = (iCurType <= 1 ? sAuthor : sPlayer);
              sTabConvoys[iConvoy]["target"] = (iCurType > 1 ? sAuthor : sPlayer);
              sTabConvoys[iConvoy]["date"] = sDate;
              sTabConvoys[iConvoy]["lang"] = (iCurLang == 0 ? "Français" : "English");
              
              // Check data.
              if ((sTabConvoys[iConvoy]["conveyor"]).length < 3)
              {
                bAlert = true;
                sAlert[sAlert.length] = "WARNING : NO CONVEYOR FOUND !";
              }
              if ((sTabConvoys[iConvoy]["target"]).length < 3)
              {
                bAlert = true;
                sAlert[sAlert.length] = "WARNING : NO RECEIVER FOUND !";
              }
              if ((iFood + iMaterial) == 0)
              {
                bAlert = true;
                sAlert[sAlert.length] = "WARNING : NOTHING SENT !";
              }
            } // ENDIF / Check if current line contains desired type and extract data if so.
          } // END / Analyse for each input language (French, English), if required.
        } // END / Analyse for each type (arrived, sent, received), if required.
        
        if (bIsNotConvoy)
        {
          // Try to detect truncated convoy declaration.
          if (new RegExp(sTabRegFindBadConvoys[p_bWarningLevel], "g").test(tabLine[iLine]))
          {
            bAlert = true;
            sAlert[sAlert.length] = "WARNING : Etes vous sur que ce n'est pas un convoi / Are you sure this not a convoy ? (\"" + (new RegExp(sTabRegFindBadConvoys[p_bWarningLevel], "g").exec(tabLine[iLine]))[0] + "\" detected)";
          }
          //Try to detect unread messages. 
          if (new RegExp(sPlayerUnreadDetector, "g").test(tabLine[iLine]))
          {
            bAlert = true;
            sAlert[sAlert.length] = "WARNING : Message \"Non lu\", certains convois pourraient être attribués au mauvais joueur / \"Unread\" message, some convoys may be assigned to the wrong player ! (\"" + (new RegExp(sPlayerUnreadDetector, "g").exec(tabLine[iLine]))[0] + "\" detected)";
          }
        }
        
        if (bError || bAlert)
        {
          // Scroll to error window and show it.
          ScrollToAndDisplayErrors();
          
          // Display errors
          AddErrorLine("[Line " + iLine + "] " + (bError ? "ERROR analysing" : "WARNING related to") + " line : ", (bError ? "" : "warning"));
          AddErrorLine("\"" + tabLine[iLine] + "\"", (bError ? "" : "raw"));
          if (!bIsNotConvoy)
          {
            AddErrorLine("[Line " + iLine + "] Detected Convoy type / lang : " + sTabConvoys[iConvoy]["type"] + " / " + sTabConvoys[iConvoy]["lang"], (bError ? "" : "warning"));
            AddErrorLine("[Line " + iLine + "] Detected Author / Date      : \"" +  sTabConvoys[iConvoy]["author"] + "\" / " + sTabConvoys[iConvoy]["date"], (bError ? "" : "warning"));
            AddErrorLine("[Line " + iLine + "] Detected Food / material    : " + Format(sTabConvoys[iConvoy]["food"], 0, " ") + " / " + Format(sTabConvoys[iConvoy]["material"], 0, " ") + ".", (bError ? "" : "warning"));
            AddErrorLine("[Line " + iLine + "] Detected Sender / receiver  : \"" + sTabConvoys[iConvoy]["conveyor"] + "\" / \"" + sTabConvoys[iConvoy]["target"] + "\"", (bError ? "" : "warning"));
          }
          // Manage parse error.
          if (bError)
          {
            nbError++;
            // Display error.
            for (iErrorLine = 0; iErrorLine < sError.length; iErrorLine++)
            {
              AddErrorLine("[Line " + iLine + "] " + sError[iErrorLine], "error");
            }
            // reinit error for next line.
            sError = new Array();
          } 
          // Manage alert.
          if (bAlert)
          {
            nbAlert++;
            // Display error.
            for (iErrorLine = 0; iErrorLine < sAlert.length; iErrorLine++)
            {
              AddErrorLine("[Line " + iLine + "] " + sAlert[iErrorLine], "warning");
            }
            // reinit alert for next line.
            sAlert = new Array();
          }
          // reinit error/alert for next line.
          bError = false;
          bAlert = false;
          
          AddErrorLine("", "raw");
        } // END IF // if (bError || bAlert)
        
      } // END / Parse each input line.
      
      return sTabConvoys;
    }
    
    function GenerateOutput()
    {
      gsOutPutText = "";
      gsOutPutTab = "";
      
      var iConvoy;
      
      var iTotalFood = 0;
      var iTotalMaterial = 0;
      var iTotalNbFood = 0;
      var iTotalNbMaterial = 0;
      
      var sFullConvoyListTxt = "Liste de tous les convois / Full convoy list : \n";
      var sFullConvoyListTab = "";
      var sConveyorTotalTxt = "Total par convoyeur / Each conveyor total : \n";
      var sConveyorTotalTab = "";
      var sReceiverTotalTxt = "Total par livré / Each receiver total : \n";
      var sReceiverTotalTab = "";
      
      var iTabConveyorTotal = new Array();
      var iTabReceiverTotal = new Array();
      var sConveyor, sReceiver;
      
      // Header for tabbed output.
      if (giCurOutput > 0)
      {
        sFullConvoyListTxt += 
            (gbTabToDisplay[0] ? gsOutputHeader[giOutputLang][0] + "\t" : "") 
          + (gbTabToDisplay[1] ? gsOutputHeader[giOutputLang][1] + "\t" : "")  
          + (gbTabToDisplay[2] ? gsOutputHeader[giOutputLang][2] + "\t" : "")  
          + (gbTabToDisplay[3] ? gsOutputHeader[giOutputLang][3] + "\t" : "")  
          + (gbTabToDisplay[4] ? gsOutputHeader[giOutputLang][4] + "\t" : "")  
          + (gbTabToDisplay[5] ? gsOutputHeader[giOutputLang][5] + "\t" : "")  
          + (gbTabToDisplay[6] ? gsOutputHeader[giOutputLang][6] + "\t" : "")  
          + (gbTabToDisplay[7] ? gsOutputHeader[giOutputLang][7] + "\t" : "")  
          + "\n";
        sConveyorTotalTxt += 
            gsOutputHeader[giOutputLang][0] + "\t" 
          + gsOutputHeader[giOutputLang][2] + "\t" 
          + gsOutputHeader[giOutputLang][3] + "\t" 
          + gsOutputHeader[giOutputLang][8] + "\t" 
          + gsOutputHeader[giOutputLang][9] + "\t" 
          + "\n";
        sReceiverTotalTxt += 
            gsOutputHeader[giOutputLang][1] + "\t" 
          + gsOutputHeader[giOutputLang][2] + "\t" 
          + gsOutputHeader[giOutputLang][3] + "\t" 
          + gsOutputHeader[giOutputLang][8] + "\t" 
          + gsOutputHeader[giOutputLang][9] + "\t" 
          + "\n";
      }
      
      // Header for chart display.
      sFullConvoyListTab += "<table><caption style='font-weight: bold;text-shadow: 2px 2px #A0A0FF;font-size:150%;'>Liste de tous les convois / Full convoy list<br/></caption><tr>" 
        + (gbTabToDisplay[0] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][0] + "</td>" : "")
        + (gbTabToDisplay[1] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][1] + "</td>" : "") 
        + (gbTabToDisplay[2] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][2] + "</td>" : "") 
        + (gbTabToDisplay[3] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][3] + "</td>" : "") 
        + (gbTabToDisplay[4] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][4] + "</td>" : "") 
        + (gbTabToDisplay[5] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][5] + "</td>" : "") 
        + (gbTabToDisplay[6] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][6] + "</td>" : "") 
        + (gbTabToDisplay[7] ? "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][7] + "</td>" : "") 
        + "</tr>";
      
      sConveyorTotalTab += "<table><caption style='font-weight: bold;text-shadow: 2px 2px #A0A0FF;font-size:150%;'>Total par convoyeur / Conveyors total<br/></caption>" 
        + "<tr>"
        + "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][0] + "</td>" 
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][2] + "</td>"  
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][3] + "</td>"
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][8] + "</td>"
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][9] + "</td>"
        + "</tr>";
      
      sReceiverTotalTab += "<table><caption style='font-weight: bold;text-shadow: 2px 2px #A0A0FF;font-size:150%;'>Total par livré / Receivers total<br/></caption>" 
        + "<tr>"
        + "<td style='padding-right:15px; font-weight: bold;'>" + gsOutputHeader[giOutputLang][1] + "</td>" 
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][2] + "</td>"
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][3] + "</td>"
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][8] + "</td>"
        + "<td style='padding-left:15px; font-weight: bold; text-align:right;'>" + gsOutputHeader[giOutputLang][9] + "</td>"
        + "</tr>";
      
      // For each extracted convoy.
      for (iConvoy = 0; iConvoy < gTabConvoys.length; iConvoy++)
      {
        // Build display of full convoy list.
        if (gbOutputFullList)
        {
          // Text output
          if (giCurOutput > 0)
          {
            sFullConvoyListTxt += 
                (gbTabToDisplay[0] ? gTabConvoys[iConvoy]["conveyor"] + "\t" : "")
              + (gbTabToDisplay[1] ? gTabConvoys[iConvoy]["target"] + "\t"  : "")
              + (gbTabToDisplay[2] ? (giCurOutput == 1 ? Format(gTabConvoys[iConvoy]["food"], 0, " ") : gTabConvoys[iConvoy]["food"]) + "\t"  : "")
              + (gbTabToDisplay[3] ? (giCurOutput == 1 ? Format(gTabConvoys[iConvoy]["material"], 0, " ") : gTabConvoys[iConvoy]["material"]) + "\t"  : "")
              + (gbTabToDisplay[4] ? gTabConvoys[iConvoy]["date"] + "\t" : "")
              + (gbTabToDisplay[5] ? gTabConvoys[iConvoy]["author"] + "\t" : "")
              + (gbTabToDisplay[6] ? gsTabOutputType[giOutputLang][gTabConvoys[iConvoy]["type"]]  + "\t" : "")
              + (gbTabToDisplay[7] ? gTabConvoys[iConvoy]["lang"]   + "\t" : "")
              + "\n";
          } else
          {
            sFullConvoyListTxt += 
                (gbTabToDisplay[0] ? gsOutputSeparator[giOutputLang][0] + gTabConvoys[iConvoy]["conveyor"] + gsOutputSeparator[giOutputLang][1]  : "")
              + (gbTabToDisplay[1] ? gsOutputSeparator[giOutputLang][2] + gTabConvoys[iConvoy]["target"] + gsOutputSeparator[giOutputLang][3]  : "") 
              + (gbTabToDisplay[2] ? gsOutputSeparator[giOutputLang][4] + Format(gTabConvoys[iConvoy]["food"], 0, " ") + gsOutputSeparator[giOutputLang][5]   : "")
              + (gbTabToDisplay[3] ? gsOutputSeparator[giOutputLang][6] + Format(gTabConvoys[iConvoy]["material"], 0, " ") + gsOutputSeparator[giOutputLang][7]   : "")
              + (gbTabToDisplay[4] ? gsOutputSeparator[giOutputLang][8] + gTabConvoys[iConvoy]["date"] + gsOutputSeparator[giOutputLang][9]  : "")
              + (gbTabToDisplay[5] ? gsOutputSeparator[giOutputLang][10] + gTabConvoys[iConvoy]["author"] + gsOutputSeparator[giOutputLang][11]  : "")
              + (gbTabToDisplay[6] ? gsOutputSeparator[giOutputLang][12] + gsTabOutputType[giOutputLang][gTabConvoys[iConvoy]["type"]] + gsOutputSeparator[giOutputLang][13] : "") 
              + "\n";
          }
          
          // Chart output.
          sFullConvoyListTab += "<tr>"
            + (gbTabToDisplay[0] ? "<td style='padding-right:15px;'>" + gTabConvoys[iConvoy]["conveyor"] + "</td>" : "")
            + (gbTabToDisplay[1] ? "<td style='padding-right:15px;'>" + gTabConvoys[iConvoy]["target"] + "</td>" : "") 
            + (gbTabToDisplay[2] ? "<td style='padding-right:15px;text-align:right;'>" + (giCurOutput < 2 ? Format(gTabConvoys[iConvoy]["food"], 0, " ") : gTabConvoys[iConvoy]["food"])  + "</td>" : "")
            + (gbTabToDisplay[3] ? "<td style='padding-right:15px;text-align:right;'>" + (giCurOutput < 2 ? Format(gTabConvoys[iConvoy]["material"], 0, " ") : gTabConvoys[iConvoy]["material"])  + "</td>" : "")
            + (gbTabToDisplay[4] ? "<td style='padding-right:15px;text-align:right;'>" + gTabConvoys[iConvoy]["date"]  + "</td>" : "")
            + (gbTabToDisplay[5] ? "<td style='padding-right:15px;'>" + gTabConvoys[iConvoy]["author"]  + "</td>" : "")
            + (gbTabToDisplay[6] ? "<td style='padding-right:15px;'>" + gsTabOutputType[giOutputLang][gTabConvoys[iConvoy]["type"]]  + "</td>" : "")
            + (gbTabToDisplay[7] ? "<td style='padding-right:15px;'>" + gTabConvoys[iConvoy]["lang"]  + "</td>" : "")
            + "</tr>";
          
        }
        
        // Compute total of all convoys
        if (gbOutputTotal)
        {
          iTotalFood += gTabConvoys[iConvoy]["food"];
          iTotalMaterial += gTabConvoys[iConvoy]["material"];
          iTotalNbFood += gTabConvoys[iConvoy]["food"] > 0 ? 1 : 0;
          iTotalNbMaterial += gTabConvoys[iConvoy]["material"] > 0 ? 1 : 0;
        }
        
        // Compute total for each conveyor
        if (gbOutputConveyorTotal)
        {
          sConveyor = gTabConvoys[iConvoy]["conveyor"];
          if (sConveyor in iTabConveyorTotal)
          {
            iTabConveyorTotal[sConveyor]["food"] += gTabConvoys[iConvoy]["food"];
            iTabConveyorTotal[sConveyor]["material"] += gTabConvoys[iConvoy]["material"];
            iTabConveyorTotal[sConveyor]["nbFood"] += (gTabConvoys[iConvoy]["food"] > 0 ? 1 : 0);
            iTabConveyorTotal[sConveyor]["nbMaterial"] += (gTabConvoys[iConvoy]["material"] > 0 ? 1 : 0);
          } else
          {
            iTabConveyorTotal[sConveyor] = new Array();
            iTabConveyorTotal[sConveyor]["food"] = gTabConvoys[iConvoy]["food"];
            iTabConveyorTotal[sConveyor]["material"] = gTabConvoys[iConvoy]["material"];
            iTabConveyorTotal[sConveyor]["nbFood"] = (gTabConvoys[iConvoy]["food"] > 0 ? 1 : 0);
            iTabConveyorTotal[sConveyor]["nbMaterial"] = (gTabConvoys[iConvoy]["material"] > 0 ? 1 : 0);
          }
        }
        
        // Compute total for each Receiver
        if (gbOutputReceiverTotal)
        {
          sReceiver = gTabConvoys[iConvoy]["target"];
          if (sReceiver in iTabReceiverTotal)
          {
            iTabReceiverTotal[sReceiver]["food"] += gTabConvoys[iConvoy]["food"];
            iTabReceiverTotal[sReceiver]["material"] += gTabConvoys[iConvoy]["material"];
            iTabReceiverTotal[sReceiver]["nbFood"] += (gTabConvoys[iConvoy]["food"] > 0 ? 1 : 0);
            iTabReceiverTotal[sReceiver]["nbMaterial"] += (gTabConvoys[iConvoy]["material"] > 0 ? 1 : 0);
          } else
          {
            iTabReceiverTotal[sReceiver] = new Array();
            iTabReceiverTotal[sReceiver]["food"] = gTabConvoys[iConvoy]["food"];
            iTabReceiverTotal[sReceiver]["material"] = gTabConvoys[iConvoy]["material"];
            iTabReceiverTotal[sReceiver]["nbFood"] = (gTabConvoys[iConvoy]["food"] > 0 ? 1 : 0);
            iTabReceiverTotal[sReceiver]["nbMaterial"] = (gTabConvoys[iConvoy]["material"] > 0 ? 1 : 0);
          }
        }
        
      }
      sFullConvoyListTab += "</table><br/>";
      
      // Build display for all convoys total.
      if (gbOutputTotal) // 8.9
      {
        // Txt output
        if (giCurOutput == 0)
        {
          gsOutPutText += "TOTAL " 
            + gsOutputHeader[giOutputLang][2] + " : " + (giCurOutput < 2 ? Format(iTotalFood, 0, " ") : iTotalFood) + ", " 
            + gsOutputHeader[giOutputLang][3] + " : " + (giCurOutput < 2 ? Format(iTotalMaterial, 0, " ") : iTotalMaterial) 
            + "\n\n";  
        } else
        {
          gsOutPutText += "Total convois / Convoys total : \n" 
            + gsOutputHeader[giOutputLang][2] + "\t" 
            + gsOutputHeader[giOutputLang][3] + "\t" 
            + gsOutputHeader[giOutputLang][8] + "\t" 
            + gsOutputHeader[giOutputLang][9] + "\t" 
            + "\n"
            + (giCurOutput < 2 ? Format(iTotalFood, 0, " ") : iTotalFood) + "\t" 
            + (giCurOutput < 2 ? Format(iTotalMaterial, 0, " ") : iTotalMaterial) + "\t" 
            + (giCurOutput < 2 ? Format(iTotalMaterial, 0, " ") : iTotalNbFood) + "\t" 
            + (giCurOutput < 2 ? Format(iTotalMaterial, 0, " ") : iTotalNbMaterial) + "\t" 
            + "\n\n";  
        }
        gsOutPutTab += "<table style='font-weight: bold;'><caption style='font-weight: bold;text-shadow: 2px 2px #A0A0FF;font-size:150%;'>Total convois / Convoys total<br/></caption>" 
          + "<tr>" 
          + "<td style='padding-left:50px; '>" + gsOutputHeader[giOutputLang][2] + "</td>" 
          + "<td style='padding-left:50px; '>" + gsOutputHeader[giOutputLang][3] + "</td>"
          + "<td style='padding-left:50px; '>" + gsOutputHeader[giOutputLang][8] + "</td>" 
          + "<td style='padding-left:50px; '>" + gsOutputHeader[giOutputLang][9] + "</td>"
          + "</tr>"
          + "<tr>"
          + "<td style='padding-left:50px; '>" + (giCurOutput < 2 ? Format(iTotalFood, 0, " ") : iTotalFood)  + "</td>"
          + "<td style='padding-left:50px; '>"+ (giCurOutput < 2 ? Format(iTotalMaterial, 0, " ") : iTotalMaterial)  + "</td>"
          + "<td style='padding-left:50px; '>" + (giCurOutput < 2 ? Format(iTotalNbFood, 0, " ") : iTotalNbFood)  + "</td>"
          + "<td style='padding-left:50px; '>"+ (giCurOutput < 2 ? Format(iTotalNbMaterial, 0, " ") : iTotalNbMaterial)  + "</td>"
          + "</tr>"
          + "</table><br/>";  
      }
      
      // Build display for each conveyor total.
      if (gbOutputConveyorTotal)
      {
        for (sConveyor in iTabConveyorTotal)
        {
          // Txt output
          if (giCurOutput > 0)
          {
            sConveyorTotalTxt += sConveyor + "\t" 
              + (giCurOutput == 1 ? Format(iTabConveyorTotal[sConveyor]["food"], 0, " ") : iTabConveyorTotal[sConveyor]["food"]) + "\t" 
              + (giCurOutput == 1 ? Format(iTabConveyorTotal[sConveyor]["material"], 0, " ") : iTabConveyorTotal[sConveyor]["material"]) + "\t"
              + (giCurOutput == 1 ? Format(iTabConveyorTotal[sConveyor]["nbFood"], 0, " ") : Format(iTabConveyorTotal[sConveyor]["nbFood"], 0, "")) + "\t"
              + (giCurOutput == 1 ? Format(iTabConveyorTotal[sConveyor]["nbMaterial"], 0, " ") : Format(iTabConveyorTotal[sConveyor]["nbMaterial"], 0, "")) + "\t"
              + "\n";
          } else
          {
            sConveyorTotalTxt += sConveyor + gsOutputSeparator[giOutputLang][3] 
              + Format(iTabConveyorTotal[sConveyor]["food"], 0, " ") + gsOutputSeparator[giOutputLang][5]  
              + Format(iTabConveyorTotal[sConveyor]["material"], 0, " ") + gsOutputSeparator[giOutputLang][7] + "\n";
          }
          // Chart output
          sConveyorTotalTab += 
            "<tr>" 
            + "<td>" + sConveyor + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabConveyorTotal[sConveyor]["food"], 0, " ") : iTabConveyorTotal[sConveyor]["food"]) + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabConveyorTotal[sConveyor]["material"], 0, " ") : iTabConveyorTotal[sConveyor]["material"]) + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabConveyorTotal[sConveyor]["nbFood"], 0, " ") : Format(iTabConveyorTotal[sConveyor]["nbFood"], 2, "")) + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabConveyorTotal[sConveyor]["nbMaterial"], 0, " ") : Format(iTabConveyorTotal[sConveyor]["nbMaterial"], 2, "")) + "</td>"
            + "</tr>";
        }
        gsOutPutText += sConveyorTotalTxt + "\n";  
        gsOutPutTab += sConveyorTotalTab + "</table><br/>"; 
      }
      
      // Build display for each receiver total.
      if (gbOutputReceiverTotal)
      {
        for (sReceiver in iTabReceiverTotal)
        {
          // Txt output
          if (giCurOutput > 0)
          {
            sReceiverTotalTxt += sReceiver + "\t" 
              + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["food"], 0, " ") : iTabReceiverTotal[sReceiver]["food"]) + "\t" 
              + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["material"], 0, " ") : iTabReceiverTotal[sReceiver]["material"]) + "\t"
              + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["nbFood"], 0, " ") : Format(iTabReceiverTotal[sReceiver]["nbFood"], 0, "")) + "\t"
              + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["nbMaterial"], 0, " ") : Format(iTabReceiverTotal[sReceiver]["nbMaterial"], 0, "")) + "\t"
              + "\n";
          } else
          {
            sReceiverTotalTxt += sReceiver + gsOutputSeparator[giOutputLang][3] 
              + Format(iTabReceiverTotal[sReceiver]["food"], 0, " ") + gsOutputSeparator[giOutputLang][5]  
              + Format(iTabReceiverTotal[sReceiver]["material"], 0, " ") + gsOutputSeparator[giOutputLang][7] + "\n";
          }
          // Chart output
          sReceiverTotalTab += 
            "<tr>"
            + "<td>" + sReceiver  + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabReceiverTotal[sReceiver]["food"], 0, " ") : iTabReceiverTotal[sReceiver]["food"]) + "</td>" 
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput < 2 ? Format(iTabReceiverTotal[sReceiver]["material"], 0, " ") : iTabReceiverTotal[sReceiver]["material"]) + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["nbFood"], 0, " ") : Format(iTabReceiverTotal[sReceiver]["nbFood"], 0, "")) + "</td>"
            + "<td style='padding-left:50px; text-align:right;'>" + (giCurOutput == 1 ? Format(iTabReceiverTotal[sReceiver]["nbMaterial"], 0, " ") : Format(iTabReceiverTotal[sReceiver]["nbMaterial"], 0, "")) + "</td>"
            + "</tr>";
        }
        gsOutPutText += sReceiverTotalTxt + "\n";  
        gsOutPutTab += sReceiverTotalTab + "</table><br/>"; 
      }
      
      // Add Full convoy list to output if required.
      gsOutPutText += (gbOutputFullList ? sFullConvoyListTxt + "\n" : "");
      gsOutPutTab += (gbOutputFullList ? sFullConvoyListTab : ""); 
      
      // Display text output.
      document.getElementById("idExtractedDatas").value = gsOutPutText;
      
      // Diplay chart output.
      document.getElementById("OutputChartDiv").innerHTML = gsOutPutTab;
      //Debug(gsOutPutTab);
    }   
    
    // Fill player list with predetermined datas.
    function FillPlayerList(asAlliance)  
    { 
      var sPlayerList = "";
       
      if (asAlliance != gsNoAlliance)
      {
        for (var i = 0; i < (gTabAlliancePlayer[asAlliance]).length; i++)
        { 
          sPlayerList += gTabAlliancePlayer[asAlliance][i] + "\n";
        }
      }
      document.getElementById("idPlayerList").value = sPlayerList;
    }
    
    // Debug log function.
    function Debug(asText)
    {
      var sText = document.getElementById("idDebug").value + " => " + asText + "\n";
      document.getElementById("idDebug").value = sText;
    }

    // Error log function. asText = message to display, asType = "error" / "warning" / "raw" (for formatting needs).
    function AddErrorLine(asText, asType)
    {
      var sText = document.getElementById("idError").value;
      
      if (asType != "raw")
      {
        sText += (asType == "warning" ? "\u2690 ? " : "\u26A0 ! ");
      }
      document.getElementById("idError").value = sText + asText + "\n";
    }
    
    // Scroll to error window and show it.
    function ScrollToAndDisplayErrors()
    {
      window.scrollTo(0, document.getElementById("idDisplayError").offsetTop);
      if (document.getElementById("idDivError").style.display == "none")
      {
        ToggleSubByID("idDivError", "idDisplayError");
      }
      setTimeout(function() {
        window.scrollTo(0, document.getElementById("idDivError").offsetTop);
      },  200);
    }
    
    // **********************************
    // DEBUG / DEMO functions.
    // **********************************
    
    function scrolling_to(iTargetPos)
    {
      var iStep = 2;
      var iTime = 2;
      var iPos = gPos + iStep;
      if (iPos <= iTargetPos)
      {
        window.scrollTo(0, iPos);
        gPos = iPos;
        setTimeout(function() { scrolling_to(iTargetPos); }, iTime);
      }
    }
    function DoDemo(bDoScroll)
    {
      if (bDoScroll)
      {
        var i = 0;
        var bTabToDisplayBackup = new Array(true, true, true, true, false, false, false, false);
        for (i = 0; i < 8; i++)
        {
          bTabToDisplayBackup[i] = gbTabToDisplay[i];
          gbTabToDisplay[i] = true;
        }
      
        gPos = 0;
        window.scrollTo(0, gPos);
        var pos = document.getElementById("ParamPlayerContainer").offsetTop;
        scrolling_to(pos);
        
        setTimeout(function() { 
          if (document.getElementById("ParamPlayerContainer").style.display == "none") 
          {
            ToggleSubByID("ParamsPlayers", "AfficherParamsPlayersLabel"); 
          }
        }, 3000);
        setTimeout(function() { 
          var sTextPlayerList = "Toto\nCalystene\nTestCalystene\nTestCalystene2\nSuperGrenier\nGrosseBouffe\nGenereuxDonateur\nMonsieurBeneficiaire\nbeneficiaire001\n";
          document.getElementById("idPlayerList").value = sTextPlayerList;
          gTabPlayer = (sTextPlayerList).split('\n');
        }, 5000);
        setTimeout(function() { 
          ToggleSubByID("ParamsPlayers", "AfficherParamsPlayersLabel"); 
        }, 7000);
        setTimeout(function() { 
          gsInputText = "Calystene\n 	Fourmizzz 	hier 20h34Convoi livré à Toto : 224 865 718 080 matériaux 	\n05/08/2014\n04:50 	Votre livraison de 0 nourriture et 74 708 405 260 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n05/08/2014\n14:04 	Votre livraison de 0 nourriture et 74 982 309 160 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n05/08/2014\n20:34 	Votre livraison de 0 nourriture et 75 175 003 660 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n- Vous allez livrer 0 nourritures et 75 688 196 980 materiaux à Toto dans 1H 54m 52s - Retour le Aug 06 à 14h10\n\nCalystene\n 		Antzzz 	Yesterday 1000Convoy sent to GrosseBouffe : 23 000 000 000 food 	\n08/05/2014\n10:00 	Your delivery of 23 000 000 000 food and 0 material arrived at GrosseBouffe. Your workers are back.\n\nCalystene\n- You are going to deliver 1 food and 0 Materials to SuperGrenier in 8m 2s - Back on Aug 6 at 12:29 pm - Cancel\n\nCalystene\nFourmizzz 	14 juillet 15h33Convoi venant de chez GenereuxDonateur 	\n	Participants (messages non-lus) : Moi\n14/07/2014\n15:33 	GenereuxDonateur vient de vous livrer 0 nourriture et 352 000 000 000 matériaux.\n\nCalystene\nAntzzz 	0748Convoy received from SuperGrenier : 150 000 000 000 material 	\n08/06/2014\n07:48 	SuperGrenier just delivered 0 food and 150 000 000 000 material to you.\n\n\n\nSuperGrenier\n\n\nEn ligne\n\nInscrit le: 19 Sep 2011\nMessages: 987\nLocalisation: \n\n	\nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0 and 60 000 000 000 to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 12:10 am\n- You are going to deliver 0 and 150 000 000 000 to Calystene in 13m 37s - Back on Aug 5 at 11:15 pm\n\n- You are going to deliver 0 and 150 000 000 000 to Calystene in 14s - Back on Aug 6 at 7:47 am\n- You are going to deliver 0 and 60 000 000 000 to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 9:11 am\n\n\nTestCalystene\nHors ligne\nInscrit le: 29 Mar 2011\nMessages: 1 811\nLocalisation: \nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\nYou are going to deliver 0 food and 80 000 000 000 Materials to beneficiaire001 in 1H 23m 29s - Back on Aug 5 at 9:23 am \n\n\nTestCalystene2\nHors ligne\nInscrit le: 10 Avr 2011\nMessages: 1 150\nLocalisation: \nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0  and 250 000 000 000  to beneficiaire001 in 11m \n\n\nSuperGrenier\nEn ligne\nInscrit le: 19 Sep 2011\nMessages: 987\nLocalisation: France\nNouveau message Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0 food and 90 000 000 000 Materials to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 10:48 pm\n- You are going to deliver 0 food and 40 000 000 000 Materials to MonsieurBeneficiaire in 30m 51s - Back on Aug 6 at 11:36 pm\n- You are going to deliver 0 food and 50 000 000 000 Materials to beneficiaire001 in 1H 22m 43s - Back on Aug 7 at 12:28 am\n";
          document.getElementById("idRawDatas").value = gsInputText;      
        }, 10000);
        setTimeout(function() { 
          Analyse(); 
          var pos = document.getElementById("AnalyseCommand").offsetTop;
          scrolling_to(pos);
        }, 12000);
         setTimeout(function() { 
          for (i = 0; i < 8; i++)
          {
            gbTabToDisplay[i] = bTabToDisplayBackup[i];
          }
        }, 13000);
      } else
      {
        var sTextPlayerList = "Toto\nCalystene\nTestCalystene\nTestCalystene2\nSuperGrenier\nGrosseBouffe\nGenereuxDonateur\nMonsieurBeneficiaire\nbeneficiaire001\n";
        document.getElementById("idPlayerList").value = sTextPlayerList;
        gTabPlayer = (sTextPlayerList).split('\n');
        gsInputText = "Calystene\n 	Fourmizzz 	hier 20h34Convoi livré à Toto : 224 865 718 080 matériaux 	\n05/08/2014\n04:50 	Votre livraison de 0 nourriture et 74 708 405 260 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n05/08/2014\n14:04 	Votre livraison de 0 nourriture et 74 982 309 160 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n05/08/2014\n20:34 	Votre livraison de 0 nourriture et 75 175 003 660 matériaux est arrivée chez Toto. Vos ouvrières sont de retour.\n- Vous allez livrer 0 nourritures et 75 688 196 980 materiaux à Toto dans 1H 54m 52s - Retour le 06 Aug à 14h10\n\nCalystene\n 		Antzzz 	Yesterday 1000Convoy sent to GrosseBouffe : 23 000 000 000 food 	\n08/05/2014\n10:00 	Your delivery of 23 000 000 000 food and 0 material arrived at GrosseBouffe. Your workers are back.\n\nCalystene\n- You are going to deliver 1 food and 0 Materials to SuperGrenier in 8m 2s - Back on Aug 6 at 12:29 pm - Cancel\n\nCalystene\nFourmizzz 	14 juillet 15h33Convoi venant de chez GenereuxDonateur 	\n	Participants (messages non-lus) : Moi\n14/07/2014\n15:33 	GenereuxDonateur vient de vous livrer 0 nourriture et 352 000 000 000 matériaux.\n\nCalystene\nAntzzz 	0748Convoy received from SuperGrenier : 150 000 000 000 material 	\n08/06/2014\n07:48 	SuperGrenier just delivered 0 food and 150 000 000 000 material to you.\n\n\n\nSuperGrenier\n\n\nEn ligne\n\nInscrit le: 19 Sep 2011\nMessages: 987\nLocalisation: \n\n	\nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0 and 60 000 000 000 to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 12:10 am\n- You are going to deliver 0 and 150 000 000 000 to Calystene in 13m 37s - Back on Aug 5 at 11:15 pm\n\n- You are going to deliver 0 and 150 000 000 000 to Calystene in 14s - Back on Aug 6 at 7:47 am\n- You are going to deliver 0 and 60 000 000 000 to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 9:11 am\n\n\nTestCalystene\nHors ligne\nInscrit le: 29 Mar 2011\nMessages: 1 811\nLocalisation: \nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\nYou are going to deliver 0 food and 80 000 000 000 Materials to beneficiaire001 in 1H 23m 29s - Back on Aug 5 at 9:23 am \n\n\nTestCalystene2\nHors ligne\nInscrit le: 10 Avr 2011\nMessages: 1 150\nLocalisation: \nMessage Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0  and 250 000 000 000  to beneficiaire001 in 11m \n\n\nSuperGrenier\nEn ligne\nInscrit le: 19 Sep 2011\nMessages: 987\nLocalisation: France\nNouveau message Système de convoi tour 12 (Juillet 2014) 	Répondre en citant\n- You are going to deliver 0 food and 90 000 000 000 Materials to beneficiaire001 in 1H 22m 56s - Back on Aug 6 at 10:48 pm\n- You are going to deliver 0 food and 40 000 000 000 Materials to MonsieurBeneficiaire in 30m 51s - Back on Aug 6 at 11:36 pm\n- You are going to deliver 0 food and 50 000 000 000 Materials to beneficiaire001 in 1H 22m 43s - Back on Aug 7 at 12:28 am\n";
        document.getElementById("idRawDatas").value = gsInputText;      
        Analyse(); 
        setTimeout(function() {
          window.scrollTo(0, document.getElementById("AnalyseCommand").offsetTop);
        },200);
      }
   }
    // **********************************
    // General purpose utility functions.
    // **********************************

    // Hide / Show Subdivisions of document.
    function ToggleSubByID(divID, labelID)  
    {  
      var bWasDisplayed = (document.getElementById(divID).style.display == "block");
      var sLabel = document.getElementById(labelID).innerHTML;
      //var sLabel = this.innerHTML;
      
      document.getElementById(divID).style.display = bWasDisplayed ? "none" : "block";
      
      if (labelID.length > 0) // If you don't want to change label give an empty string as label ID.
      {
        if (bWasDisplayed)
        {
          sLabel = sLabel.replace("Masquer", "Afficher");
          sLabel = sLabel.replace("Hide", "Show");
          sLabel = sLabel.replace(new RegExp("\u25B2", "g"), "\u25BC");
        } else
        {
          sLabel = sLabel.replace("Afficher", "Masquer");
          sLabel = sLabel.replace("Show", "Hide");
          sLabel = sLabel.replace(new RegExp("\u25BC", "g"), "\u25B2");
        }
        document.getElementById(labelID).innerHTML = sLabel;
      }
    }
    
    // Format a number.
    function Format(valeur, decimal, separateur)
    {
      // formate un chiffre avec 'decimal' chiffres après la virgule et un separateur
        var deci=Math.round(Math.pow(10, decimal) * (Math.abs(valeur) - Math.floor(Math.abs(valeur))));
        var val = Math.floor(Math.abs(valeur));
        if ((decimal == 0)||(deci == Math.pow(10, decimal))) {val = Math.floor(Math.abs(valeur)); deci = 0;}
        var val_format = val + "";
        var nb = val_format.length;
        for (var i = 1; i < 20; i++)
        {
          if (val >= Math.pow(10, (3 * i)))
          {
            val_format = val_format.substring(0, nb - (3 * i)) + separateur + val_format.substring(nb - (3 * i));
          }
        }
        if (decimal > 0)
        {
          var decim = "";
          for (var j = 0; j < (decimal - deci.toString().length); j++) {decim += "0";}
          deci = decim + deci.toString();
          val_format = val_format + "." + deci;
        }
        if (parseFloat(valeur) < 0) {val_format = "- " + val_format;}
        return val_format;
    }
    
    // Remove all empty line (including lines with only tab and/or spaces).
    function RemoveEmptyLines(s)
    {
      return s.replace(/\n[ \t\r\n]*\n/g, "\n");
    }
    
    // remove all spaces in substring.
    function RemoveAllSpaces(s)  
    {
      return s.replace(/[ \t\r]+/g,"");
    }
    // remove all spaces at start and end of string.
    function TrimSpaces(s)
    {
      return s.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
    }
    
    // parse a raw string and return an array with four indexes/values : "HourFound"/boolean, "HourTxt"/string,  "DateFound"/boolean, "DateTxt"/string.
    function parseDate(p_sRawData)
    {
      // Any format among : "00:00 am", "0:00 am", "00h00 am", "0h00 am", "00:00 pm", "0:00 pm", "00h00 pm", "0h00 pm", "00:00", "0:00", "00h00", "0h00"
      var sTxtRegFindHour = "(([0-9]){1,2}[\h,\:][0-9][0-9] am)|(([0-9]){1,2}[\h,\:][0-9][0-9] pm)|(([0-9]){1,2}[\h,\:][0-9][0-9])";
      
      // Any format among : "00/00/00", "00/00/0000", "Jan 0", "Jan 00"
      var sTxtRegFindDate = new Array("([0-9][0-9]\/[0-9][0-9]\/([0-9][0-9]){1,2})", "((Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ([0-9]){1,2})", "(([0-9]){1,2} (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec))");
      
      var tabMonth = {"Jan" : "01", "Feb" : "02", "Mar" : "03", "Apr" : "04", "May" : "05", "Jun" : "06", 
        "Jul" : "07", "Aug" : "08", "Sep" : "09", "Oct" : "10", "Nov" : "11", "Dec" : "12"};
      
      var retDate = new Array();
      retDate["HourFound"] = false;
      retDate["HourTxt"] = "";
      retDate["DateFound"] = false;
      retDate["DateTxt"] = "";
      
      var sHour = "";
      var sSplitHour = new Array();
      var sDate;
      var iTemp = 0;
      var now = new Date();
      //Debug(now.toString());
      
      // Try to find hour : 
      if (new RegExp(sTxtRegFindHour, "").test(p_sRawData))
      {
        sHour = (new RegExp(sTxtRegFindHour, "g").exec(p_sRawData))[0];
        //Debug("\"" + sHour.toString() + "\"");
        retDate["HourFound"] = true;
        
        // split hour/minute
        if (new RegExp(":", "").test(sHour))
        {
          sSplitHour = sHour.split(":");
        } 
        else if (new RegExp("h", "").test(sHour))
        {
          sSplitHour = sHour.split("h");
        }
        else
        {
          retDate["HourFound"] = false;
          sSplitHour[0] = "0";
          sSplitHour[1] = "0";
        }
        // Manage "am" hour
        iTemp = parseInt(sSplitHour[0]) + (new RegExp("pm", "g").test(sSplitHour[1]) ? 12 : 0);
        retDate["HourTxt"] += (iTemp < 10 ? "0" : "") + iTemp;
        iTemp = parseInt(sSplitHour[1]);
        retDate["HourTxt"] += (iTemp < 10 ? ":0" : ":") + iTemp;
      } // END IF / Try to find hour  
      
      // Try to find date.
      if (new RegExp(sTxtRegFindDate[0] + "|" + sTxtRegFindDate[1] + "|" + sTxtRegFindDate[2], "").test(p_sRawData))
      {
        sDate = (new RegExp(sTxtRegFindDate[0] + "|" + sTxtRegFindDate[1] + "|" + sTxtRegFindDate[2], "").exec(p_sRawData))[0];
        retDate["DateFound"] = true;
        retDate["DateTxt"] = sDate;
        
        // Manage "00/00/00" and "00/00/0000" format.
        if (new RegExp(sTxtRegFindDate[0], "").test(sDate))
        {
          iTemp = parseInt((sDate.split("\/"))[2]);
          retDate["DateTxt"] = sDate.substr(0, 6) + (iTemp < 2000 ? (iTemp + 2000) : iTemp);
        }
        
        // Manage "Jan 0" and "Jan 00" formats.
        if (new RegExp(sTxtRegFindDate[1], "").test(sDate))
        {
          // Date of the day.
          iTemp = parseInt(sDate.substr(3, 3));
          retDate["DateTxt"] = (iTemp < 10 ? "0" : "") + iTemp + "/";
          // Month.
          retDate["DateTxt"] += (tabMonth[sDate.substr(0, 3)] + "/");
          // Year.
          iTemp = now.getFullYear();
          if (parseInt(tabMonth[sDate.substr(0, 3)]) == 1 && now.getMonth() == 11) iTemp++;
          retDate["DateTxt"] += iTemp;
        }
        
        // Manage "0 Jan" and "00 Jan" formats.
        if (new RegExp(sTxtRegFindDate[2], "").test(sDate))
        {
          // Date of the day.
          iTemp = parseInt(sDate.substr(0, 3));
          retDate["DateTxt"] = (iTemp < 10 ? "0" : "") + iTemp + "/";
          // Month.
          Debug("sDate = \"" + sDate + "\" -> sDate.substr(0, 3) = \"" + sDate.substr(0, 3) + "\"");
          retDate["DateTxt"] += (tabMonth[sDate.substr(3, 3)] + "/");
          // Year.
          iTemp = now.getFullYear();
          if (parseInt(tabMonth[sDate.substr(3, 3)]) == 1 && now.getMonth() == 11) iTemp++;
          retDate["DateTxt"] += iTemp;
        }
        
      } // END IF / Try to find date
      
      return retDate;
    }
    
    
  </script>

  </head>
  <body background="Fond2.bmp">
    <a href='http://alliancead2.free.fr/public.php' style='color:blue; '><b></b> <<< Back <i>(Outils mis à disposition)</i></a><br/>
    <center><h1>Extracteur de convoi /<i> Convoy parser</i> / v 1.06 </h1><hr></center>

    <div id="Params" style="display:block;">
      <a name="Parametres" style='font-weight: bold; font-size:120%;'><b>Paramètres / Parameters:</b></a><br/><hr/>
      <form method="post" action="#" style="padding-left:30px; line-height:35px;">
        
        <label style="margin:10px;"><b><u>Entrée / Input</u> : </b><i>(Pas besoin de changer sauf cas particulier / No need to change unless special case)</i></label><br/>
        
        <a id="DisplayInputParam" style="padding-left:30px; text-decoration:underline; cursor:pointer; color:#660099;" name="DisplayInputParam" onclick="ToggleSubByID( 'idDivInputParam', 'DisplayInputParam');"> &#x25BC; Afficher / Show &#x25BC; </a> <br/> 
        
        <div id ="idDivInputParam" style="display:none; padding-left:50px;">
          <input type="checkbox" name="ParamArrived" style="" value="1" onchange="gbArrived = this.checked;" checked> Convois arrivés / Arrived convoys <i> (Votre livraison... / Your delivery of...)</i></input><br/>
          <input type="checkbox" name="ParamSent" style="" value="1" onchange="gbSent = this.checked;" checked> Convois envoyés / Sent convoys <i> (Vous allez livrer... / You are going to deliver...)</i></input><br/>
          <input type="checkbox" name="ParamReceived" style="" value="1" onchange="gbReceived = this.checked;" checked> Convois reçus / Received convoys <i> (X vient de vous livrer... / X just delivered...)</i></input><br/>
          <!--br/-->
          <input type="checkbox" name="ParamFrench" style="margin-top:25px;" value="1" onchange="gbFrenchInput = this.checked;" checked> Entrée en Français / French Input <i> (Votre livraison... / Vous allez livrer... / X vient de vous livrer...)</i></input><br/>
          <input type="checkbox" name="ParamEnglish" style="" value="1" onchange="gbEnglishInput = this.checked;" checked> Entrée en Anglais / English Input <i> (Your delivery of... / You are going to deliver... / X just delivered...)</i></input><br/>
        </div>
        
        <label style="margin:10px;"><b><u>Sortie / Output</u> : </b></label><br/>
        
        <table style="padding-left:30px; line-height:35px;">
          <tr>
            <td>
              <label>Format de sortie / Output formatting : </label>
            </td>
            <td>
              <select name="TypeOutput" id="TypeOutput" size="1" onchange="giCurOutput = this.selectedIndex;">
                <script language="javascript">
                  for (var i = 0; i < gTabOutput.length; i++)
                  {
                    document.write("<OPTION" + (i == giCurOutput ? " selected" : "") + ">" + gTabOutput[i] + "</OPTION>");
                  }
                </script>
              </select>
            </td> 
          </tr> 
          <tr>
            <td>
              <label>Langue du rapport / Output language : </label>
            </td>
            <td>
              <select name="OutputLang" id="OutputLang" size="1" onchange="giOutputLang = this.selectedIndex;">
                <script language="javascript">
                  for (var i = 0; i < gTabLang.length; i++)
                  {
                    document.write("<OPTION" + (i == giOutputLang ? " selected" : "") + ">" + gTabLang[i] + "</OPTION>");
                  }
                </script>
              </select>
            </td>
          </tr>
          <tr>
        </table>
        
        <div id ="idDivOutputParamType" style="display:block;padding-left:20px;">
          <table>
            <tr><td><input type="checkbox" name="ParamTotal" style="margin:10px;" value="1" onchange="gbOutputTotal = this.checked;" checked> Total des convois / Convoy total</input></td></tr>
            <tr><td><input type="checkbox" name="ParamConveyorTotal" style="margin:10px;" value="1" onchange="gbOutputConveyorTotal = this.checked;" checked> Total par convoyeur / Each conveyor total</input></td></tr>
            <tr><td><input type="checkbox" name="ParamReceiverTotal" style="margin:10px;" value="1" onchange="gbOutputReceiverTotal = this.checked;" checked> Total par livré / Each receiver total</input></td></tr>
            <tr><td><input type="checkbox" name="ParamFullList" style="margin:10px;" value="1" onchange="gbOutputFullList = this.checked;" checked> Liste de tous les convois / Convoy full list </input></td></tr>
          </table>
        </div>
        
        <a id="DisplayOutputChooseData" style="padding-left:30px; text-decoration:underline; cursor:pointer; color:#660099;" onclick="ToggleSubByID('idDivOutputParamChooseData', 'DisplayOutputChooseData');"> &#x25BC; Afficher autres options / Show other options &#x25BC; </a> <br/> 
        
        <div id ="idDivOutputParamChooseData" style="display:none;padding-left:50px;">
          <table style="line-height:35px;">
            <tr>
              <td style="padding-right:40px;"><input type="checkbox" name="ParamTabOutput" id="ParamTabOutput" style="padding-right:30px;" value="1" onchange="ToggleSubByID('TabOutputDiv', '');" checked> Sortie tableau / Chart output </input></td>
              <td><input type="checkbox" name="ParamTxtOutput" style="" value="1" onchange="ToggleSubByID('OutputDiv', '');" checked> Sortie texte brut  / Raw text output </input></td>
            </tr>
           <tr>
              <td>
                <label>Niveau d'alerte / Warning level : </label>
              </td>
              <td>
                <select name="AlertLevelChoice" id="AlertLevelChoice" size="1" onchange="giWarningLevel = this.selectedIndex;">
                  <script language="javascript">
                    for (var i = 0; i < 3; i++)
                    {
                      document.write("<OPTION" + (i == giWarningLevel ? " selected" : "") + ">" + gsWarningLevel[i] + "</OPTION>");
                    }
                  </script>
                </select>
                <label> (fausses alertes plus fréquentes en niveau haut / Higher false detection risk when level high)</label>
              </td> 
            </tr> 
          </table>
          
          <table style="padding-top:10px; line-height:35px;">
            <tr>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData1" style="" value="1" onchange="gbTabToDisplay[0] = this.checked;" checked> Convoyeur / Conveyor </input></td>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData2" style="" value="1" onchange="gbTabToDisplay[1] = this.checked;" checked> Livré / Receiver </input></td>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData3" style="" value="1" onchange="gbTabToDisplay[2] = this.checked;" checked> Nourriture / Food </input></td>
              <td><input type="checkbox" name="ParamOutputData4" style="" value="1" onchange="gbTabToDisplay[3] = this.checked;" checked> Matériaux / Materials </input></td>
            </tr><tr>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData5" style="" value="1" onchange="gbTabToDisplay[4] = this.checked;" checked> Date / Date </input></td>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData6" style="" value="1" onchange="gbTabToDisplay[5] = this.checked;" > Déclarant / Poster </input></td>
              <td style="padding-right:20px;"><input type="checkbox" name="ParamOutputData7" style="" value="1" onchange="gbTabToDisplay[6] = this.checked;" > Type déclaration / Declaration type </input></td>
              <td><input type="checkbox" name="ParamOutputData8" style="" value="1" onchange="gbTabToDisplay[7] = this.checked;" > Langue serveur / Server language </input></td>
            </tr>
          </table>
        </div>

      </form>
    </div>
    <hr/>
    <a id="AfficherAide" style="padding-left:10px; padding-right:10px; text-decoration:underline; cursor:pointer; color:#660099;" name="AfficherAide" onclick="ToggleSubByID('Aide', 'AfficherAide');"> &#x25BC; Afficher Aide / Show Help &#x25BC; </a>  
    <a id="idDemo" style="padding-left:10px; padding-right:10px; text-decoration:underline; cursor:pointer; color:#660099;" name="idDemo" onclick="DoDemo(true);"> &#x2605; Demo &#x2605; </a>
    <a id="idDisplayError" style="padding-left:10px; padding-right:10px; text-decoration:underline; cursor:pointer; color:#660099;" name="idDisplayError" onclick="ToggleSubByID('idDivError', 'idDisplayError');"> &#x25BC; Show Errors &#x25BC; </a>
    <a id="idFastDemo" style="padding-left:10px; padding-right:10px; text-decoration:underline; cursor:pointer; color:#660099;" name="idFastDemo" onclick="DoDemo(false);"><i> &#x2605; Fast demo (instant) &#x2605; </i></a>
    <a id="AfficherDebug" style="padding-left:10px; padding-right:10px; text-decoration:underline; cursor:pointer; color:#660099;" name="AfficherDebug" onclick="ToggleSubByID('idDivDebug', 'AfficherDebug');"><i> &#x25BC; Show Debug &#x25BC; </i></a>
    <br/>
    <hr/>
    
    <div id="Aide" style="display:none;">
      <div id="AideInside" style="padding-left:40px;">
        <b><u>Mode d'emploi sommaire</u> :</b><br/>
        <br/>
        Utilitaire développé vite fait pour comptabiliser d'un coup une série de convois reçus ou déclarés sur un forum.<br/>
        <br/>
        1. Pour identifier les auteurs des messages, utiliser le "Paramètrage déclarants", en mettant la liste des joueurs de l'alliance (un nom par ligne). Quelques présélections sont disponibles pour remplir automatiquement cette liste, si vous copiez l'utilitaire en local sur votre ordi ou sur le site de votre alliance, vous pourrez en rajouter ou les modifier... Une autre solution de remplissage rapide est de coller une page alliance dans un tableur puis de ne copier que la colonne des pseudos, pour la coller dans le champ texte.<br/><br/>
        2. Se positionner sur le forum (interne ou externe). &#x26A0 Sur le forum interne "Non lu" se colle au pseudo du joueur ("toto" devient "totoNon lu") assurez vous de n'avoir aucun message non lu avant de copier !<br/><br/>
        3. Tout copier (Ctrl+A Ctrl+C)<br/><br/>
        4. Coller dans la zone de texte Input "Coller ici les données à analyser"<br/><br/>
        5. Si plusieurs pages (forums externes) copier les pages suivantes et les coller à la suite dans la zone de texte...<br/><br/>
        6. Sélectionner la langue et le format de sortie dans les paramètres en haut puis cliquer sur le lien "Analyser" entre les deux zones de texte...<br/><br/>
        7. Les résultats sont affichés dans la zone de sortie, soit sous forme de tableau soit sous forme texte "brut" en dessous (pour copier dans un forum ou dans un tableur)...<br/><br/>
        <i>
        <b><u>Basic user guide</u> :</b><br/>
        <br/>
        Tool quickly developped to comptabilize a set of convoys received or posted on a forum.<br/>
        <br/>
        1. To identify posters (messages authors), display "Poster parameters", setting players's aliases (one name on each raw). Some preselection are available to fill this list, if you make a local copy to your computer or your alliance site, you can modify or add preselections... Another fast way to fill the list is to paste alliance page member chart to a spreadsheet and then copy only aliases column to paste it in the text field.<br/><br/>
        2. Get to forum (either internal or external).  &#x26A0  On internal forum "Unread" is attached to player alias ("toto" becomes "totoUnread"), please check you have no unread message before copying internal forum subject. <br/><br/>
        3. Copy all (Ctrl+A Ctrl+C)<br/><br/>
        4. Past in text field Input "past here data to analyse"<br/><br/>
        5. If several pages from an external forum, you can paste them all.<br/><br/>
        6. Select language and output formatting in top parameters and then clic on "Analyse" link, between Input and Output zones.<br/><br/>
        7. Results are displayed in output zone, either as charts, either as 'raw' text bellow (to copy/paste to a forum or spreadsheet).<br/><br/>
        </i>
        
        <b><u>Historique révisions / Revision history</u> :</b><br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.00 (6 to 12 Aug 2014) : </b>création & debug (rev 1.00.01 to 1.00.12).<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.01 (13 Aug 2014) : </b>Détection et affichage des erreurs d'analyse + gestion date & heure améliorée + mises à jour diverses / <i>Analysis errors detection and display + improved date & hour management + various updates.</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.02 (14 Aug 2014) : </b>Ajout des alertes, correction heure anglaise, ajout date au format "11 Aug", etc... / <i>Added warnings, bug fix on am/pm hours, management of "11 Aug" format dates, etc...</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.03 (18 Aug 2014) : </b>Choix du niveau d'alerte / <i>Warning level choice</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.04 (19 Aug 2014) : </b>Refactoring pour compatibilité Chrome (+ réutilisation du code pour d'autres outils), encodage UTF-8 / <i>Refactoring for Chrome compatibility (+ code reusability for other tools), UTF-8 encoding</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.05 (20 Aug 2014) : </b>Ajout d'une alerte en cas  de message "Non lu" (forum interne) / <i>Add warning on "Unread" messages (internal forum)</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.06 (10 Fev 2015) : </b>MàJ liste prédéfinie / <i>Update predifined player list</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; <b>v 1.06.01 (08 Nov 2016) : </b>Correction bug mineur type de convois + MàJ liste prédéfinie / <i>Minor convoy type bug fix + update predifined player list</i>.<br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp; ...<br/><br/> 
      </div>
      <hr/>
    </div>
    
    <div id="idDivDebug" style="display:none;">
      <div id="idDivDebugInside" style="padding-left:40px;">
        <b>Fenêtre de Debug / Debug window :</b><br />
        <textarea type="text" name="idDebug" id="idDebug" style="width:100%;height:400px;" onchange="gTabPlayer = (this.value).split('\n');"></textarea><br />
      </div>
      <hr/>
    </div>
    
    <div id="idDivError" style="display:none;">
      <div id="idDivErrorInside" style="padding-left:40px;">
        <b>Erreurs d'analyse / Analysis errors :</b><br />
        <textarea type="text" name="idError" id="idError" style="width:100%;height:400px;"></textarea><br />
        Vous pouvez corriger l'erreur dans le champ input ou à la source (dans le forum) et ré-importer les données. Vous pouvez ensuite relancer l'analayse.<br/>
        <i> You can either correct error in input text field or in source (forum) an re-import data. You can then re-launch analysis. </i><br/>
      </div>
      <hr/>
    </div>
    
    <div id="ParamPlayerContainer" style="line-height:35px;">
      <a name="PosterParameters" style="padding-left:30px; font-weight: bold; font-size:120%;"><b>Paramètrage déclarants / Poster parameters :</b></a>
      
      <a id="AfficherParamsPlayersLabel" name="AfficherParamsPlayersLabel" style="padding-left:30px; text-decoration:underline; cursor:pointer; color:#660099;" onclick="ToggleSubByID('ParamsPlayers', 'AfficherParamsPlayersLabel')"> &#x25B2; Masquer / Hide &#x25B2; </a><br/>
      
      <div id="ParamsPlayers" style="display:block;">
        <div id="ParamsPlayersInside" style="padding-left:40px;">
          Remplir avec une préselection / Fill with preselected data : <select id="idAllianceChoice" size="1" onchange="FillPlayerList(this.value);"> </select>
          <script language="javascript">
            for (var i = 0; i < gTabAllianceChoice.length; i++)  
            { 
              document.getElementById("idAllianceChoice").innerHTML += 
                "<option" + (i == 0 ? " selected" : "") + ">" + gTabAllianceChoice[i] + "</option>"; 
            }
          </script>
          <br/>
          <b>Liste des joueurs auteurs possibles des messages / Potential message posters list:</b><br/>
          <textarea type="text" name="idPlayerList" id="idPlayerList" style="width:50%;height:200px;" onchange="gTabPlayer = (this.value).split('\n');"></textarea><br />
          <br/>
        </div>
      </div>
      
      <hr/>
    </div>
    
    <div id="InputDiv"  style="display:block;">
      <div id="InputDivInside" style="padding-left:30px;padding-right:30px;">
        <form name="InputForm" method="post" action="#">
          <a name="aInput"  style='font-weight: bold; font-size:120%;'>Input : <i>coller ici les données à analyser / past here data to analyse</i></a><br/><br/>
          <textarea type="text" name="idRawDatas" id="idRawDatas" style="width:100%;height:400px;" onchange="gsInputText = RemoveEmptyLines(this.value); this.value = gsInputText;"></textarea> <br/>
        </form>
      </div>
      <hr/>
    </div>

    <div id="AnalyseDiv"  style="display:block;">
      <a id="AnalyseCommand" name="AnalyseCommand" style="text-decoration:underline; cursor:pointer; color:#660099;" onclick="Analyse();"><center><b> <h1>&#8595; Analyser &#8595; </h1> </b></center></a> 
      <hr/>
    </div>
    
    <div id="TabOutputDiv" name="TabOutputDiv" style="display:block;">
      <div id="TabOutputDivInside" style="padding-left:30px;padding-right:30px;padding-bottom:30px;">
        <a name="aTabOutput"  style='font-weight: bold; font-size:120%;'>Output : <i>données extraites (présentation tableau) / extracted data (chart display)</i></a><br/><br/>
        <div id="OutputChartDiv" style="padding-left:3px;padding-right:3px;padding-bottom:3px;display:block;">
        </div>
      </div>
      <hr/>
    </div>
    
    <div id="OutputDiv" name="OutputDiv" style="display:block;">
      <div id="OutputDivInside" style="padding-left:30px;padding-right:30px;">
        <form name="OutputForm" method="post" action="#">
          <a name="aOutput"  style='font-weight: bold; font-size:120%;'>Output : <i>données extraites (texte brut) / extracted data (raw text)</i></a><br/><br/>
          <textarea type="text" name="idExtractedDatas" id="idExtractedDatas" style="width:100%;height:400px;" onchange=""></textarea> <br/>
          <br/>
        </form>
      </div>
      <hr/>
    </div>
    

</body></html>

